<div class="container">
    <mat-tab-group>
        <mat-tab i18n-label="@@node_mgmt" label="Node Management">

            <div>
                <h3 matLine i18n="@@node_notice">Please copy the following node_key into config.json of all replica
                    nodes.</h3>

                <span class="wrapkey">{{ rpcService.hexNodesKey }}</span>
            </div>
            <mat-list class="mat-list-item-list-stacked">
                <mat-list-item *ngFor="let node of rpcService.nodes" (click)="onSelect(node)"
                    [class.selected]="node === selectedNode">
                    <mat-icon matListIcon matTooltip="This node may be offline!" matTooltipPosition="right" color="warn"
                        *ngIf="!node.online;else elseBlock">games</mat-icon>
                    <ng-template #elseBlock>
                        <mat-icon matListIcon color="primary">games</mat-icon>
                    </ng-template>
                    <h3 matLine> {{node.last_ip}} &nbsp;&nbsp;&nbsp;&nbsp;( version: {{ node.version }} ) </h3>

                </mat-list-item>
            </mat-list>
        </mat-tab>
        <mat-tab i18n-label="@@api_interface" label="API Interface">
            <div>
                <h3 matLine i18n="@@api_notice">Please copy the following API Key if you want to manage this gateway by
                    external control panel.</h3>
                <span class="wrapkey">{{ rpcService.hexAPIKey }}</span>
                <div>
                    <h4>Interface Address</h4>
                    <code>
                            POST http://IP:9080/janusec-admin/ui-api                              
                        </code>

                    <h4>Content-Type</h4>
                    <code>
                            Content-Type: application/json
                        </code>

                    <h4>JSON Body for get object(s)</h4>
                    <code>
                        {{ '{' }}"auth_key":"...", "action":"...", "id":...{{ '}' }}
                    </code>
                    <p>
                        id is a snake id string, not a number, because it exceeds the range of number.
                        id is required for one object, not required for objects list.
                    </p>

                    <h4>auth_key</h4>
                    <p>
                        The auth_key is a time-related parameter, please make sure the time is correct. auth_key is
                        generated by function GenAuthKey(hex.DecodeString(APIKey)) and it is used to verify the identity
                        of the requester.
                    </p>
                    <code><pre>
            auth_key := GenAuthKey(hex.DecodeString(APIKey))    

            func GenAuthKey(key []byte) string {{ '{' }}
                authTime := AuthTime{{ '{' }}
                    CurTime: time.Now().Unix()
                {{ '}' }}
                authTimeBytes, err := json.Marshal(authTime)
                if err != nil {{ '{' }}
                    fmt.Println("GenAuthKey", err)
                {{ '}' }}
                encryptedAuthBytes := EncryptWithKey(authTimeBytes, key)
                return hex.EncodeToString(encryptedAuthBytes)
            {{ '}' }}

            type AuthTime struct {{ '{' }}
                CurTime int64 `json:"cur_time"`
            {{ '}' }}

            func EncryptWithKey(plaintext []byte, key []byte) []byte {{ '{' }}
                block, err := aes.NewCipher(key)
                if err != nil {{ '{' }}
                    fmt.Println("EncryptWithKey NewCipher", err)
                {{ '}' }}
                nonce := make([]byte, 12)
                _, err = io.ReadFull(rand.Reader, nonce)
                if err != nil {{ '{' }}
                    fmt.Println("EncryptWithKey ReadFull", err)
                {{ '}' }}
                aesgcm, err := cipher.NewGCM(block)
                if err != nil {{ '{' }}
                    fmt.Println("EncryptWithKey NewGCM", err)
                {{ '}' }}
                ciphertext := aesgcm.Seal(nonce, nonce, plaintext, nil)
                return ciphertext
            {{ '}' }}

                    </pre></code>

                    <h4>action</h4>
                    <ul>
                        <li>
                            get_certs: get all digital certificates, not include acme automatic certificates
                        </li>
                        <li>
                            get_cert: get digital certificate with designated id, parameter id is required and use
                            certificate id string here
                        </li>
                        <li>
                            get_apps: get all web applications
                        </li>
                        <li>
                            get_vip_apps: get all virtual IP applications, i.e. TCP/UDP port forwarding applications
                        </li>
                        <li>
                            get_vuln_types: get all vulnerability types
                        </li>
                        <li>
                            get_group_policies: get all group policies/rules for WAF
                        </li>
                        <li>
                            get_cc_policy: get CC policy with designated application id, parameter id is required and
                            use
                            application id string here, '0' for all applications.
                        </li>
                    </ul>

                    <h4>Response of objects list</h4>
                    <code><pre>
                {{ '{' }}"err":null,"object":[...]{{ '}' }}
                    </pre></code>

                    <h4>Response of one object</h4>
                    <code><pre>
                {{ '{' }}"err":null,"object": {{ '{' }}...{{ '}' }} {{ '}' }}
                    </pre></code>

                    <h4>JSON Body for create or update an object</h4>
                    <code><pre>
                {{ '{' }}"action":"...", "auth_key":"...", "object":...{{ '}' }}
                    </pre></code>


                </div>
            </div>
        </mat-tab>
    </mat-tab-group>
</div>